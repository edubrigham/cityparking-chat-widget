class CityparkingChatWidget extends HTMLElement{constructor(e={}){super(),this.attachShadow({mode:"open"}),this.noAnswerCount=0,this.isCollectingUserInfo=!1,this.isGeneratingResponse=!1,this.conversationHistory=[],this.config={webhookUrl:e.webhookUrl||e.chatUrl||null,language:e.language||document.documentElement.lang?.toLowerCase()||"en",theme:{primaryColor:e.theme?.primaryColor||"#009648",position:e.theme?.position||"bottom-right",...e.theme}},this.sessionToken=this.generateSessionToken(),this.messages={welcome:{en:"Welcome! I am Cue, your digital assistant powered by AI! üëã\nI'm here to help you with parking questions in Doornik.\n\nYou can ask questions about:\n‚Ä¢ Parking zones\n‚Ä¢ Resident permits\n‚Ä¢ Parking fees\n‚Ä¢ Special permits",nl:"Welkom! Ik ben Cue, uw digitale assistent gemaakt door AI! üëã\nIk ben hier om je te helpen met vragen over parkeren in Doornik.\n\nJe kunt vragen stellen over:\n‚Ä¢ Parkeerzones\n‚Ä¢ Residentenpermissies\n‚Ä¢ Parkeergeld\n‚Ä¢ Speciale permissies",fr:"Bienvenue! Je suis Cue, votre assistant digitale aliment√© par l'IA! üëã\nJe suis l√† pour vous aider avec vos questions sur le stationnement √† Tournai.\n\nVous pouvez poser des questions sur:\n‚Ä¢ Zones de stationnement\n‚Ä¢ Permis de r√©sident\n‚Ä¢ Frais de stationnement\n‚Ä¢ Permis sp√©ciaux"},confirmation:{question:{en:"Would you like Cityparking to handle your question?",nl:"Wilt u dat Cityparking uw vraag behandelt?",fr:"Souhaitez-vous que Cityparking traite votre question?"},buttons:{yes:{en:"Yes, please",nl:"Ja, graag",fr:"Oui, s'il vous pla√Æt"},no:{en:"No, thanks",nl:"Nee, bedankt",fr:"Non, merci"}},decline:{en:"No problem! Feel free to ask another question.",nl:"Geen probleem! Stel gerust een andere vraag.",fr:"Pas de probl√®me ! N'h√©sitez pas √† poser une autre question."}},errors:{general:{en:"Sorry, I encountered an error. Please try again.",nl:"Sorry, er is een fout opgetreden. Probeer het opnieuw.",fr:"D√©sol√©, j'ai rencontr√© une erreur. Veuillez r√©essayer."},submitInfo:{en:"Sorry, I encountered an error submitting your information.",nl:"Sorry, er is een fout opgetreden bij het versturen van uw gegevens.",fr:"D√©sol√©, j'ai rencontr√© une erreur lors de l'envoi de vos informations."}},userInfo:{formTitle:{en:"Contact Support",nl:"Contacteer Support",fr:"Contacter le Support"},firstName:{en:"First Name",nl:"Voornaam",fr:"Pr√©nom"},lastName:{en:"Last Name",nl:"Achternaam",fr:"Nom de famille"},email:{en:"Email Address",nl:"E-mailadres",fr:"Adresse e-mail"},phone:{en:"Phone Number",nl:"Telefoonnummer",fr:"Num√©ro de t√©l√©phone"},question:{en:"Your Question",nl:"Jouw vraag",fr:"Votre question"},submitButton:{en:"Submit",nl:"Verzenden",fr:"Soumettre"},submitting:{en:"Submitting...",nl:"Verzenden...",fr:"Envoi en cours..."},validation:{required:{en:"Please fill out all required fields.",nl:"Vul alstublieft alle verplichte velden in.",fr:"Veuillez remplir tous les champs obligatoires."},email:{en:"Please enter a valid email address (e.g., name@example.com)",nl:"Voer een geldig e-mailadres in (bijv. naam@voorbeeld.com)",fr:"Veuillez entrer une adresse e-mail valide (ex: nom@exemple.com)"},phone:{en:"Please enter a valid Belgian phone number (e.g., 0470123456 or 02123456)",nl:"Voer een geldig Belgisch telefoonnummer in (bijv. 0470123456 of 02123456)",fr:"Veuillez entrer un num√©ro de t√©l√©phone belge valide (ex: 0470123456 ou 02123456)"}}},placeholder:{en:"What are you looking for?",nl:"Waar ben je naar op zoek?",fr:"Que recherchez-vous?"},sourceButton:{en:"Source",nl:"Bron",fr:"Source"}},this.createWidget(),this.initialize()}generateSessionToken(){return"widget_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}createWidget(){const e=this.config.theme.position.includes("left"),n=`\n            :host {\n                --widget-height: 600px;\n                --widget-width: 350px;\n                --primary-color: ${this.config.theme.primaryColor};\n                --secondary-color: #f8f9fa;\n                --header-color: ${this.config.theme.primaryColor};\n                font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;\n            }\n            \n            .chat-widget {\n                position: fixed;\n                bottom: 20px;\n                ${e?"left":"right"}: 20px;\n                z-index: 1000;\n            }\n            \n            .chat-button {\n                width: 60px;\n                height: 60px;\n                border-radius: 50%;\n                background: var(--primary-color);\n                border: none;\n                cursor: pointer;\n                position: fixed;\n                bottom: 20px;\n                ${e?"left":"right"}: 20px;\n                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n                transition: transform 0.2s;\n                color: white;\n                font-size: 24px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            \n            .chat-button:hover {\n                transform: scale(1.1);\n            }\n            \n            .chat-container {\n                position: fixed;\n                bottom: 90px;\n                ${e?"left":"right"}: 20px;\n                width: var(--widget-width);\n                height: var(--widget-height);\n                background: white;\n                border-radius: 15px;\n                box-shadow: 0 5px 20px rgba(0,0,0,0.15);\n                display: none;\n                flex-direction: column;\n                overflow: hidden;\n            }\n            \n            .chat-container.active {\n                display: flex;\n            }\n            \n            .chat-header {\n                background: var(--primary-color);\n                color: white;\n                padding: 20px;\n                font-weight: normal;\n                font-size: 16px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                position: relative;\n            }\n            \n            .close-button {\n                background: none;\n                border: none;\n                color: white;\n                font-size: 20px;\n                cursor: pointer;\n                padding: 0;\n                line-height: 1;\n            }\n            \n            .close-button:hover {\n                opacity: 0.8;\n            }\n            \n            .chat-messages {\n                flex-grow: 1;\n                padding: 20px;\n                overflow-y: auto;\n                display: flex;\n                flex-direction: column;\n                gap: 15px;\n                background: white;\n            }\n            \n            .message {\n                max-width: 85%;\n                padding: 12px 16px;\n                border-radius: 20px;\n                margin: 2px 0;\n                font-size: 14px;\n                line-height: 1.4;\n                font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;\n            }\n            \n            .user-message {\n                background: var(--primary-color);\n                color: white;\n                align-self: flex-end;\n                border-bottom-right-radius: 5px;\n            }\n            \n            .bot-message-container {\n                display: flex;\n                align-items: flex-start;\n                gap: 8px;\n                max-width: 85%;\n                align-self: flex-start;\n            }\n            \n            .bot-avatar {\n                width: 32px;\n                height: 32px;\n                min-width: 32px;\n                border-radius: 50%;\n                background: var(--primary-color);\n                margin-right: 8px;\n                flex-shrink: 0;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                font-weight: bold;\n                font-size: 14px;\n            }\n            \n            .bot-message {\n                background: #E8E8E8;\n                color: black;\n                align-self: flex-start;\n                border-bottom-left-radius: 5px;\n                margin: 0;\n                line-height: 1.4;\n                white-space: pre-wrap;\n                padding: 12px 16px;\n            }\n            \n            .chat-input {\n                display: flex;\n                padding: 15px;\n                background: white;\n                border-top: 1px solid #eee;\n            }\n            \n            .chat-input input {\n                flex-grow: 1;\n                padding: 12px;\n                border: 1px solid #eee;\n                border-radius: 25px;\n                margin-right: 10px;\n                font-size: 14px;\n                font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;\n            }\n            \n            .chat-input input:focus {\n                outline: none;\n                border-color: var(--primary-color);\n            }\n            \n            .chat-input input:disabled {\n                background-color: #f5f5f5;\n                cursor: not-allowed;\n            }\n            \n            .chat-input button {\n                width: 40px;\n                height: 40px;\n                background: var(--primary-color);\n                color: white;\n                border: none;\n                border-radius: 50%;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 20px;\n            }\n            \n            .chat-input button:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n            \n            .sources {\n                font-size: 0.8em;\n                margin-top: 8px;\n                display: flex;\n                gap: 8px;\n            }\n            \n            .source-button {\n                padding: 6px 12px;\n                background: white;\n                color: var(--primary-color);\n                border: 1px solid var(--primary-color);\n                border-radius: 15px;\n                cursor: pointer;\n                font-size: 12px;\n                transition: all 0.2s;\n            }\n            \n            .source-button:hover {\n                background: var(--primary-color);\n                color: white;\n            }\n            \n            .action-buttons {\n                display: flex;\n                gap: 10px;\n                margin-top: 10px;\n            }\n            \n            .action-button {\n                padding: 8px 16px;\n                border-radius: 20px;\n                cursor: pointer;\n                font-size: 14px;\n                border: 1px solid var(--primary-color);\n                transition: all 0.2s;\n            }\n            \n            .action-button.primary {\n                background: var(--primary-color);\n                color: white;\n            }\n            \n            .action-button.secondary {\n                background: white;\n                color: var(--primary-color);\n            }\n            \n            .action-button:hover {\n                opacity: 0.9;\n            }\n            \n            .typing-indicator {\n                display: flex;\n                gap: 4px;\n                padding: 8px 12px;\n                background: #f0f0f0;\n                border-radius: 10px;\n                width: fit-content;\n            }\n            \n            .typing-dot {\n                width: 6px;\n                height: 6px;\n                background: var(--primary-color);\n                border-radius: 50%;\n                opacity: 0.3;\n                animation: typingAnimation 1.4s infinite;\n            }\n            \n            .typing-dot:nth-child(2) {\n                animation-delay: 0.2s;\n            }\n            \n            .typing-dot:nth-child(3) {\n                animation-delay: 0.4s;\n            }\n            \n            @keyframes typingAnimation {\n                0%, 100% { opacity: 0.3; transform: scale(1); }\n                50% { opacity: 1; transform: scale(1.2); }\n            }\n            \n            .powered-by {\n                text-align: center;\n                padding: 8px;\n                font-size: 12px;\n                color: #666;\n                border-top: 1px solid #eee;\n            }\n            \n            .powered-by a {\n                color: var(--primary-color);\n                text-decoration: none;\n            }\n            \n            .powered-by a:hover {\n                text-decoration: underline;\n            }\n\n            .user-info-form-container {\n                flex-grow: 1;\n                padding: 20px;\n                overflow-y: auto;\n                background: white;\n                display: none;\n            }\n\n            .user-info-form h3 {\n                margin-top: 0;\n                font-size: 18px;\n                text-align: center;\n                color: #333;\n            }\n\n            .form-field {\n                margin-bottom: 15px;\n            }\n\n            .form-field label {\n                display: block;\n                margin-bottom: 5px;\n                font-size: 14px;\n                color: #555;\n            }\n\n            .form-field input,\n            .form-field textarea {\n                width: 100%;\n                padding: 10px;\n                font-size: 14px;\n                border: 1px solid #ddd;\n                border-radius: 8px;\n                box-sizing: border-box;\n            }\n\n            .form-field textarea {\n                resize: vertical;\n                min-height: 100px;\n            }\n\n            .form-submit-button {\n                width: 100%;\n                padding: 12px;\n                background-color: var(--primary-color);\n                color: white;\n                border: none;\n                border-radius: 8px;\n                cursor: pointer;\n                font-size: 16px;\n                margin-top: 10px;\n                transition: background-color 0.2s;\n            }\n\n            .form-submit-button:disabled {\n                background-color: #ccc;\n                cursor: not-allowed;\n            }\n\n            .form-submit-button:hover:not(:disabled) {\n                opacity: 0.9;\n            }\n        `;this.shadowRoot.innerHTML=`\n            <style>${n}</style>\n            <div class="chat-widget">\n                <button class="chat-button">üí¨</button>\n                <div class="chat-container">\n                    <div class="chat-header">\n                        <span>Cityparking Assistant</span>\n                        <button class="close-button">√ó</button>\n                    </div>\n                    <div class="chat-messages"></div>\n                    <div class="user-info-form-container"></div>\n                    <div class="chat-input">\n                        <input type="text" placeholder="${this.messages.placeholder[this.config.language]||this.messages.placeholder.en}">\n                        <button>‚û§</button>\n                    </div>\n                    <div class="powered-by">\n                        Powered by <a href="https://www.ringring.be" target="_blank">RingRing</a>\n                    </div>\n                </div>\n            </div>\n        `}initialize(){const e=this.shadowRoot.querySelector(".chat-button"),n=this.shadowRoot.querySelector(".chat-container"),t=this.shadowRoot.querySelector(".close-button"),o=this.shadowRoot.querySelector("input"),s=this.shadowRoot.querySelector(".chat-input button"),i=(this.shadowRoot.querySelector(".chat-messages"),this.messages.welcome[this.config.language]||this.messages.welcome.en);this.addMessage(i,"bot",[],!0),e.addEventListener("click",()=>{n.classList.contains("active")?n.classList.remove("active"):(n.classList.add("active"),o.focus())}),t.addEventListener("click",()=>{n.classList.remove("active")}),s.addEventListener("click",()=>this.sendMessage()),o.addEventListener("keypress",e=>{"Enter"===e.key&&this.sendMessage()})}setInputState(e){const n=this.shadowRoot.querySelector(".chat-input input"),t=this.shadowRoot.querySelector(".chat-input button");n.disabled=!e,t.disabled=!e,e&&n.focus()}async sendMessage(){const e=this.shadowRoot.querySelector("input"),n=e.value.trim();if(n&&!this.isGeneratingResponse&&!this.isCollectingUserInfo){this.isGeneratingResponse=!0,this.setInputState(!1),this.addMessage(n,"user"),e.value="";try{const e=document.createElement("div");e.classList.add("bot-message-container");const t=document.createElement("div");t.classList.add("bot-avatar"),t.textContent="C";const o=document.createElement("div");o.classList.add("typing-indicator");for(let e=0;e<3;e++){const e=document.createElement("div");e.classList.add("typing-dot"),o.appendChild(e)}const s=document.createElement("div");s.classList.add("message","bot-message"),s.style.display="none",e.appendChild(t),e.appendChild(o),e.appendChild(s);const i=this.shadowRoot.querySelector(".chat-messages");i.appendChild(e);const a=await fetch(this.config.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatInput:n,sessionId:this.sessionToken})}),r=a.headers.get("content-type")||"";if(!(r.includes("text/plain")||r.includes("text/event-stream"))){const e=await a.json();if(o.remove(),s.style.display="block",e.response){let n=e.response.replace(/\*\*/g,"");if(s.textContent=n,e.actions&&e.actions.length>0){const n=document.createElement("div");n.classList.add("sources"),e.actions.forEach(e=>{if("url"===e.type){const t=document.createElement("button");t.classList.add("source-button"),t.textContent=e.text||"Link",t.addEventListener("click",()=>{window.open(e.payload,"_blank")}),n.appendChild(t)}}),s.appendChild(n)}else if(e.sources&&e.sources.length>0){const n=document.createElement("div");n.classList.add("sources");const t=e.sources.slice(0,2),o=this.messages.sourceButton[this.config.language]||this.messages.sourceButton.en;t.forEach((e,t)=>{const s=document.createElement("button");s.classList.add("source-button"),s.textContent=`${o} ${t+1}`,s.addEventListener("click",()=>{window.open(e,"_blank")}),n.appendChild(s)}),s.appendChild(n)}}else if(e.content){let n=e.content.replace(/\*\*/g,"");s.textContent=n}else s.textContent=JSON.stringify(e);return void(i.scrollTop=i.scrollHeight)}const l=a.body.getReader(),d=new TextDecoder;let c=!1,u=!0;for(;;){const{value:e,done:n}=await l.read();if(n)break;const t=d.decode(e).split("\n").filter(e=>e.trim());for(const e of t)try{const n=JSON.parse(e);switch(u&&(o.remove(),s.style.display="block",u=!1),n.type){case"token":let e=n.content.replace(/\*\*/g,"");e.includes("‚Ä¢")&&(e=`<br>‚Ä¢ ${e.replace("‚Ä¢","")}`),e.includes("\n")&&(e=e.replace(/\n/g,"<br>")),/[.!?]/.test(e)&&(e+=" "),s.innerHTML+=e,this.scrollToBottom();break;case"rephrase":this.noAnswerCount++,s.textContent=n.content,this.scrollToBottom();break;case"needsUserInfo":if(n.content){s.textContent=this.messages.confirmation.question[this.config.language]||this.messages.confirmation.question.en;await this.handleConfirmation(s)?c=!0:this.noAnswerCount=0}else this.noAnswerCount=0;break;case"showForm":u&&(o.remove(),s.style.display="none",u=!1),this.showUserInfoForm();break;case"sources":if(n.content&&n.content.length>0){const e=document.createElement("div");e.classList.add("sources");const t=n.content.slice(0,2),o=this.messages.sourceButton[this.config.language]||this.messages.sourceButton.en;t.forEach((n,t)=>{const s=document.createElement("button");s.classList.add("source-button"),s.textContent=`${o} ${t+1}`,s.addEventListener("click",()=>{window.open(n,"_blank")}),e.appendChild(s)}),s.appendChild(e),this.scrollToBottom()}break;case"error":s.textContent=this.messages.errors.general[this.config.language]||this.messages.errors.general.en,this.scrollToBottom()}}catch(e){console.error("Error parsing response:",e)}}c&&(this.showUserInfoForm(),this.noAnswerCount=0)}catch(e){console.error("Error:",e),this.addMessage(this.messages.errors.general[this.config.language]||this.messages.errors.general.en,"bot")}finally{this.isGeneratingResponse=!1,this.setInputState(!0)}}}validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}validateBelgianPhone(e){const n=e.replace(/[\s.-]/g,"");return/^(?:\+32|0)4\d{8}$/.test(n)||/^(?:\+32|0)\d{8}$/.test(n)}showUserInfoForm(){const e=this.shadowRoot.querySelector(".user-info-form-container"),n=this.shadowRoot.querySelector(".chat-messages"),t=this.shadowRoot.querySelector(".chat-input"),o=`\n            <div class="user-info-form">\n                <h3>${this.messages.userInfo.formTitle[this.config.language]||this.messages.userInfo.formTitle.en}</h3>\n                <div class="form-field">\n                    <label for="firstName">${this.messages.userInfo.firstName[this.config.language]||this.messages.userInfo.firstName.en}</label>\n                    <input type="text" id="firstName" name="firstName" required>\n                </div>\n                <div class="form-field">\n                    <label for="lastName">${this.messages.userInfo.lastName[this.config.language]||this.messages.userInfo.lastName.en}</label>\n                    <input type="text" id="lastName" name="lastName" required>\n                </div>\n                <div class="form-field">\n                    <label for="email">${this.messages.userInfo.email[this.config.language]||this.messages.userInfo.email.en}</label>\n                    <input type="email" id="email" name="email" required>\n                </div>\n                <div class="form-field">\n                    <label for="phone">${this.messages.userInfo.phone[this.config.language]||this.messages.userInfo.phone.en}</label>\n                    <input type="tel" id="phone" name="phone" required>\n                </div>\n                <div class="form-field">\n                    <label for="question">${this.messages.userInfo.question[this.config.language]||this.messages.userInfo.question.en}</label>\n                    <textarea id="question" name="question" required></textarea>\n                </div>\n                <button class="form-submit-button">${this.messages.userInfo.submitButton[this.config.language]||this.messages.userInfo.submitButton.en}</button>\n            </div>\n        `;e.innerHTML=o,n.style.display="none",t.style.display="none",e.style.display="block";e.querySelector(".form-submit-button").addEventListener("click",()=>this.handleFormSubmit())}hideUserInfoForm(){const e=this.shadowRoot.querySelector(".user-info-form-container"),n=this.shadowRoot.querySelector(".chat-messages"),t=this.shadowRoot.querySelector(".chat-input");e.innerHTML="",e.style.display="none",n.style.display="flex",t.style.display="flex"}async handleFormSubmit(){const e=this.shadowRoot.querySelector(".user-info-form"),n=e.querySelector(".form-submit-button"),t=e.querySelector("#firstName").value.trim(),o=e.querySelector("#lastName").value.trim(),s=e.querySelector("#email").value.trim(),i=e.querySelector("#phone").value.trim(),a=e.querySelector("#question").value.trim();if(!t||!o||!a)return void this.addMessage(this.messages.userInfo.validation.required[this.config.language]||this.messages.userInfo.validation.required.en,"bot");if(!this.validateEmail(s))return void this.addMessage(this.messages.userInfo.validation.email[this.config.language]||this.messages.userInfo.validation.email.en,"bot");if(!this.validateBelgianPhone(i))return void this.addMessage(this.messages.userInfo.validation.phone[this.config.language]||this.messages.userInfo.validation.phone.en,"bot");const r={name:t,lastname:o,email:s,phone:i,question:a,language:this.config.language,conversation:this.conversationHistory};n.disabled=!0,n.textContent=this.messages.userInfo.submitting[this.config.language]||this.messages.userInfo.submitting.en;try{const e=await this.submitUserInfo(r);this.hideUserInfoForm(),this.addMessage(e.message||e.error||"Form submitted successfully!","bot")}catch(e){this.addMessage(this.messages.errors.submitInfo[this.config.language]||this.messages.errors.submitInfo.en,"bot")}finally{this.setInputState(!0)}}async submitUserInfo(e){try{const n=await fetch(this.config.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatInput:"form_submission",sessionId:this.sessionToken,formData:e})});if(!n.ok)throw new Error("Failed to submit user info");return await n.json()}catch(e){throw console.error("Error submitting user info:",e),e}}addMessage(e,n,t=[],o=!1){this.conversationHistory.push({type:n,text:e.replace(/<[^>]*>/g,""),timestamp:(new Date).toISOString()});const s=this.shadowRoot.querySelector(".chat-messages");if("bot"===n){const n=document.createElement("div");n.classList.add("bot-message-container");const i=document.createElement("div");i.classList.add("bot-avatar"),i.textContent="C";const a=document.createElement("div");if(a.classList.add("message","bot-message"),o&&a.classList.add("welcome-message"),a.innerHTML=e,t&&t.length>0){const e=document.createElement("div");e.classList.add("sources"),e.innerHTML="Sources:<br>"+t.map(e=>`- ${e}`).join("<br>"),a.appendChild(e)}n.appendChild(i),n.appendChild(a),s.appendChild(n)}else{const n=document.createElement("div");n.classList.add("message","user-message"),n.textContent=e,s.appendChild(n)}this.scrollToBottom()}scrollToBottom(e=!0){setTimeout(()=>{requestAnimationFrame(()=>{const n=this.shadowRoot.querySelector(".chat-messages"),t=e?{behavior:"smooth"}:{behavior:"auto"};n.scrollTo({top:n.scrollHeight+100,behavior:t.behavior})})},100)}async handleConfirmation(e){return this.setInputState(!1),new Promise(n=>{const t=document.createElement("div");t.classList.add("action-buttons");const o=document.createElement("button");o.classList.add("action-button","primary"),o.textContent=this.messages.confirmation.buttons.yes[this.config.language]||this.messages.confirmation.buttons.yes.en;const s=document.createElement("button");s.classList.add("action-button","secondary"),s.textContent=this.messages.confirmation.buttons.no[this.config.language]||this.messages.confirmation.buttons.no.en,t.appendChild(o),t.appendChild(s),e.appendChild(t),o.addEventListener("click",()=>{t.remove(),this.showUserInfoForm(),n(!0)}),s.addEventListener("click",()=>{t.remove();const e=this.messages.confirmation.decline[this.config.language]||this.messages.confirmation.decline.en;this.addMessage(e,"bot"),this.setInputState(!0),n(!1)})})}}window.initCityparkingWidget=function(e={}){if(e.webhookUrl||e.chatUrl){if(!document.querySelector("cityparking-chat-widget")){customElements.define("cityparking-chat-widget",CityparkingChatWidget);const n=new CityparkingChatWidget(e);n.setAttribute("id","cityparking-chat-widget"),document.body.appendChild(n),console.log("CityParking Chat Widget initialized with config:",e)}}else console.error("CityparkingWidget: webhookUrl is required")},document.addEventListener("DOMContentLoaded",()=>{const e=document.currentScript||document.querySelector("script[data-webhook-url], script[data-chat-url]");e&&(e.dataset.webhookUrl||e.dataset.chatUrl)&&window.initCityparkingWidget({webhookUrl:e.dataset.webhookUrl||e.dataset.chatUrl,language:e.dataset.language||document.documentElement.lang,theme:{primaryColor:e.dataset.primaryColor||e.dataset.widgetBtnColor,position:e.dataset.position||e.dataset.btnPosition||"bottom-right"}})});